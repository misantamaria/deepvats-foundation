---

title: Load data from the longwall


keywords: fastai
sidebar: home_sidebar

summary: "Methods for loading data"
description: "Methods for loading data"
nb_path: "nbs/load.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/load.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Read-data-from-HMB-longwall">Read data from HMB longwall<a class="anchor-link" href="#Read-data-from-HMB-longwall"> </a></h2><p>We will take data from one day of the shearer. the data is hosted at <a href="https://aida.ii.uam.es/2018-01-15.csv">https://aida.ii.uam.es/2018-01-15.csv</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/home/user/data/PACMEL-2019/2018-01-06.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>description</th>
      <th>Status kombajnu</th>
      <th>Łącznik sterowania</th>
      <th>Stan ramienia lewego</th>
      <th>Stan ramienia prawego</th>
      <th>Stan ciągnika lewego</th>
      <th>Stan ciągnika prawego</th>
      <th>Stan pompy lewej</th>
      <th>Stan pompy prawej</th>
      <th>Stan kruszarki</th>
      <th>...</th>
      <th>Prąd fazy 3.15</th>
      <th>Zabezpieczenie.15</th>
      <th>Przeciążenie.15</th>
      <th>Zwarcie.21</th>
      <th>Asymetria.21</th>
      <th>Ciągłość żyły.15</th>
      <th>Doziemienie.15</th>
      <th>Temperatura.15</th>
      <th>Unnamed: 373</th>
      <th>Unnamed: 374</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-01-06 00:00:00</td>
      <td>2091</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>...</td>
      <td>3.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2018-01-06 00:00:01</td>
      <td>2091</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>...</td>
      <td>3.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-01-06 00:00:02</td>
      <td>2091</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>...</td>
      <td>3.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2018-01-06 00:00:03</td>
      <td>2091</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>...</td>
      <td>3.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2018-01-06 00:00:04</td>
      <td>2091</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>...</td>
      <td>3.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 375 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 86400 entries, 0 to 86399
Columns: 375 entries, description to Unnamed: 374
dtypes: float64(181), int64(10), object(184)
memory usage: 247.2+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The timestamp is given in the column <code>description</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">df1</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the dimensionality reduction we might be interested only in the numeric columns</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_numeric</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As detailed in the TimeCluster paper, the data will be normalized into the range $[0, 1]$. Also, NaN columsn will be removed.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">data_numeric</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
<span class="c1">#data_numeric[data_numeric.select_dtypes(include=&#39;float&#39;)] = (tmp - tmp.min())/(tmp.max()-tmp.min())</span>
<span class="n">data_numeric</span><span class="p">[</span><span class="n">data_numeric</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">-</span> <span class="n">tmp</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">tmp</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_numeric</span> <span class="o">=</span> <span class="n">data_numeric</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we define a function that gathers all this operations</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fpreprocess_numeric_vars" class="doc_header"><code>fpreprocess_numeric_vars</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fpreprocess_numeric_vars</code>(<strong><code>data</code></strong>, <strong><code>cname_ts</code></strong>=<em><code>None</code></em>, <strong><code>normalize</code></strong>=<em><code>True</code></em>, <strong><code>nan_replacement</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Preprocess a dataframe <code>data</code> containing the monitoring data from a mining longwall.     Non-numeric variables will be removed. Each column     is expected to have values of a variable in form of a time series, whose index will be described in the     column named <code>cname_ts</code>. If <code>cname_ts</code> is None (default), the index of the dataframe is assumed to contain the     timestamps. .NaN values will be     replaced by a constant value <code>nan_replacement</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/data/PACMEL-2019/JNK/jnk_before_handling_missing.pickle&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">bin_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocessed_df</span> <span class="o">=</span> <span class="n">fpreprocess_numeric_vars</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">SM_ShearerLocation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preprocessed_df</span><span class="o">.</span><span class="n">SM_ShearerLocation</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Read-multiple-monitoring-files,-given-as-daily-CSVs">Read multiple monitoring files, given as daily CSVs<a class="anchor-link" href="#Read-multiple-monitoring-files,-given-as-daily-CSVs"> </a></h2><p>Since the mining monitoring data is given a set of CSV files, one per day, it is usefl to have a function to load multiple files in order to analyse data from multiple days</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fread_and_concat" class="doc_header"><code>fread_and_concat</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fread_and_concat</code>(<strong><code>paths</code></strong>, <strong>**<code>read_args</code></strong>)</p>
</blockquote>
<p>Read, from <code>paths</code>, a list of mining dataframes and concat them. All dataframes     must have the same columns.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/data/PACMEL-2019/343_HMB/2018-01-14.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;/data/PACMEL-2019/343_HMB/2018-01-15.csv&#39;</span><span class="p">]</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">fread_and_concat</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">df2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">test</span><span class="o">.</span><span class="n">all_equal</span><span class="p">([</span><span class="n">df1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">df2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fread_mining_monitoring_files" class="doc_header"><code>fread_mining_monitoring_files</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fread_mining_monitoring_files</code>(<strong><code>paths</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Read monitoring files from the PACMEL mining use case.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/data/PACMEL-2019/343_HMB/2018-01-14.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;/data/PACMEL-2019/343_HMB/2018-01-15.csv&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">fread_mining_monitoring_files</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Time-series-artifacts-(to-be-used-with-weights-and-biases)">Time series artifacts (to be used with weights and biases)<a class="anchor-link" href="#Time-series-artifacts-(to-be-used-with-weights-and-biases)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This class is meant to extend <code>wandb.Artifact</code> for logging/using files with time series data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TSArtifact" class="doc_header"><code>class</code> <code>TSArtifact</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L54" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TSArtifact</code>(<strong><code>name</code></strong>, <strong><code>sd</code></strong>:<code>Timestamp</code>, <strong><code>ed</code></strong>:<code>Timestamp</code>, <strong><code>description</code></strong>:<code>Optional</code>[<code>str</code>]=<em><code>None</code></em>, <strong><code>metadata</code></strong>:<code>Optional</code>[<code>dict</code>]=<em><code>None</code></em>, <strong><code>incremental</code></strong>:<code>Optional</code>[<code>bool</code>]=<em><code>None</code></em>) :: <code>Artifact</code></p>
</blockquote>
<p>Flexible and lightweight building block for dataset and model versioning.</p>
<p>Constructs an empty artifact whose contents can be populated using its
<code>add</code> family of functions. Once the artifact has all the desired files,
you can call <code>wandb.log_artifact()</code> to log it.</p>
<p>Arguments:
    name: (str) A human-readable name for this artifact, which is how you
        can identify this artifact in the UI or reference it in <code>use_artifact</code>
        calls. Names can contain letters, numbers, underscores, hyphens, and
        dots. The name must be unique across a project.
    type: (str) The type of the artifact, which is used to organize and differentiate
        artifacts. Common types include <code>dataset</code> or <code>model</code>, but you can use any string
        containing letters, numbers, underscores, hyphens, and dots.
    description: (str, optional) Free text that offers a description of the artifact. The
        description is markdown rendered in the UI, so this is a good place to place tables,
        links, etc.
    metadata: (dict, optional) Structured data associated with the artifact,
        for example class distribution of a dataset. This will eventually be queryable
        and plottable in the UI. There is a hard limit of 100 total keys.</p>
<p>Examples:
    Basic usage</p>

<pre><code>```
wandb.init()

artifact = wandb.Artifact('mnist', type='dataset')
artifact.add_dir('mnist/')
wandb.log_artifact(artifact)
```

</code></pre>
<p>Raises:
    Exception: if problem.</p>
<p>Returns:
    An <code>Artifact</code> object.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># resampling frequency</span>
<span class="n">resampling_freq</span> <span class="o">=</span> <span class="s1">&#39;5s&#39;</span>
<span class="c1"># handle missing values technique</span>
<span class="n">missing_values_technique</span><span class="o">=</span><span class="s1">&#39;overall_median&#39;</span>

<span class="c1"># testing dataframe</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">makeMissingDataframe</span><span class="p">()</span>
<span class="n">df_test</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_test</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>

<span class="n">artifact</span> <span class="o">=</span> <span class="n">TSArtifact</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span> 
                              <span class="n">name</span><span class="o">=</span><span class="s1">&#39;JNK&#39;</span><span class="p">,</span> 
                              <span class="n">missing_values_technique</span><span class="o">=</span><span class="n">missing_values_technique</span><span class="p">,</span>
                              <span class="n">resampling_freq</span><span class="o">=</span><span class="n">resampling_freq</span><span class="p">,</span> 
                              <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">artifact</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;TS&#39;: {&#39;sd&#39;: &#39;2021-01-01 00:00:00&#39;,
  &#39;ed&#39;: &#39;2021-01-01 00:00:29&#39;,
  &#39;created&#39;: &#39;from-df&#39;,
  &#39;n_vars&#39;: 4,
  &#39;handle_missing_values_technique&#39;: &#39;overall_median&#39;,
  &#39;has_missing_values&#39;: &#39;False&#39;,
  &#39;n_samples&#39;: 6,
  &#39;freq&#39;: &#39;&lt;5 * Seconds&gt;&#39;,
  &#39;vars&#39;: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;],
  &#39;normalization&#39;: {&#39;means&#39;: {&#39;A&#39;: 0.3837807973595773,
    &#39;B&#39;: -0.1702837787510083,
    &#39;C&#39;: 0.0003015766713802802,
    &#39;D&#39;: -0.18042534224509024},
   &#39;stds&#39;: {&#39;A&#39;: 0.28755677338495317,
    &#39;B&#39;: 0.29094157184208197,
    &#39;C&#39;: 0.5287787048279057,
    &#39;D&#39;: 0.5244784339968553}},
  &#39;hash&#39;: &#39;7582266588543823729&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At the end, we are interested in working with time series as a dataframe. So we need a function to download the files contained in a <code>wandb.apis.public.Artifact</code> object and process them into a TS dataframe. The process of passing from files to dataframe must be different depending on what type of creation method was used to generate the original <a href="/timecluster_hub/load.html#TSArtifact"><code>TSArtifact</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Artifact.to_df" class="doc_header"><code>Artifact.to_df</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Artifact.to_df</code>()</p>
</blockquote>
<p>Download the files of a saved wandb artifact and process them as a single dataframe. The artifact must     come from a call to <code>run.use_artifact</code> with a proper wandb run.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For convenience, we can write a method to cast a downloaded wandb artifact (instance from <code>wandb.apis.public,Artifact</code>) to a TSArtifact</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Artifact.to_tsartifact" class="doc_header"><code>Artifact.to_tsartifact</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L174" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Artifact.to_tsartifact</code>()</p>
</blockquote>
<p>Cast an artifact as a TS artifact. The artifact must have been created from one of the     class creation methods of the class <a href="/timecluster_hub/load.html#TSArtifact"><code>TSArtifact</code></a>. This is useful to go back to a TSArtifact     after downloading an artifact through the wand API</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_longwall_data_artifact" class="doc_header"><code>create_longwall_data_artifact</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_longwall_data_artifact</code>(<strong><code>root_path</code></strong>, <strong><code>start_date</code></strong>, <strong><code>end_date</code></strong>, <strong><code>longwall_name</code></strong>=<em><code>'Unnamed_longwall'</code></em>, <strong><code>wandb_run</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create a wandb artifact of type <code>dataset</code>, containing the CSV files from <code>start_date</code>     to <code>end_date</code>. Dates must be pased as <code>datetime.datetime</code> objects. If a <code>wandb_run</code> is     defined, the created artifact will be logged to that run, using the longwall name as     artifact name, and the date range as version.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;create_dataset&#39;</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

                Logging results to <a href="https://wandb.com" target="_blank">Weights & Biases</a> <a href="https://docs.wandb.com/integrations/jupyter.html" target="_blank">(Documentation)</a>.<br/>
                Project page: <a href="https://app.wandb.ai/vrodriguezf/timecluster-extension" target="_blank">https://app.wandb.ai/vrodriguezf/timecluster-extension</a><br/>
                Run page: <a href="https://app.wandb.ai/vrodriguezf/timecluster-extension/runs/1qaeu0v9" target="_blank">https://app.wandb.ai/vrodriguezf/timecluster-extension/runs/1qaeu0v9</a><br/>
            
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sd</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ed</span> <span class="o">=</span> <span class="n">sd</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ar</span> <span class="o">=</span> <span class="n">create_longwall_data_artifact</span><span class="p">(</span><span class="n">root_path</span><span class="o">=</span><span class="s1">&#39;/data/PACMEL-2019/343_HMB&#39;</span><span class="p">,</span> 
                                   <span class="n">start_date</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> 
                                   <span class="n">end_date</span><span class="o">=</span><span class="n">ed</span><span class="p">,</span>
                                   <span class="n">longwall_name</span><span class="o">=</span><span class="s1">&#39;HMB&#39;</span><span class="p">,</span> 
                                   <span class="n">wandb_run</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ar</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="n">ar</span><span class="o">.</span><span class="n">manifest</span><span class="o">.</span><span class="n">entries</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-2abda2236751&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> sd <span class="ansi-blue-fg">=</span> datetime<span class="ansi-blue-fg">.</span>strptime<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;2018-01-01&#34;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;%Y-%m-%d&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> ed <span class="ansi-blue-fg">=</span> sd <span class="ansi-blue-fg">+</span> timedelta<span class="ansi-blue-fg">(</span>hours<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> ar = create_longwall_data_artifact(root_path=&#39;/data/PACMEL-2019/343_HMB&#39;, 
</span><span class="ansi-green-intense-fg ansi-bold">      4</span>                                    start_date<span class="ansi-blue-fg">=</span>sd<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>                                    end_date<span class="ansi-blue-fg">=</span>ed<span class="ansi-blue-fg">,</span>

<span class="ansi-red-fg">NameError</span>: name &#39;create_longwall_data_artifact&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Try to use the logged artifact</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ar_recovered</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">use_artifact</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;HMB:2018-01-01_2018-01-04&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;dataset&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ar_recovered</span><span class="o">.</span><span class="n">download</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">retrieved_data</span> <span class="o">=</span> <span class="n">fread_mining_monitoring_files</span><span class="p">(</span><span class="nb">dir</span><span class="o">.</span><span class="n">ls</span><span class="p">(),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">retrieved_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Load-longwall-data-artifact">Load longwall data artifact<a class="anchor-link" href="#Load-longwall-data-artifact"> </a></h3><p>This function is quite handy to turn the contents of a longwall artifact, created with the function <a href="/timecluster_hub/load.html#create_longwall_data_artifact"><code>create_longwall_data_artifact</code></a>. This is specially useful in the case where the monitoring files are given in a daily basis, but you are only interested in analysing a couple of hours of data. In that case, the artifact will link the whole day file, but using the metadata, this function will only read the corresponding</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_longwall_data_artifact" class="doc_header"><code>load_longwall_data_artifact</code><a href="https://gitlab.geist.re/pml/x_timecluster_extension/tree/master/timecluster_hub/load.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_longwall_data_artifact</code>(<strong><code>a</code></strong>:<code>Artifact</code>)</p>
</blockquote>
<p>Returns a dataframe with the longwall data, subsetted by the artifact metadata</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO: Tiene que haber un error si el start date pasado es menor que el inicio del primer fichero, y lo mismo con el end date final</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/data/PACMEL-2019/343_HMB/2018-01-01.csv&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">fread_mining_monitoring_files</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">create_longwall_data_artifact</span><span class="p">(</span><span class="n">root_path</span><span class="o">=</span><span class="s1">&#39;/data/PACMEL-2019/343_HMB/&#39;</span><span class="p">,</span> 
                                  <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> 
                                  <span class="n">end_date</span><span class="o">=</span><span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> 
                                  <span class="n">wandb_run</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_subset</span> <span class="o">=</span> <span class="n">load_longwall_data_artifact</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">df_subset</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df_subset</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">start_date</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df_subset</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">df_subset</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">end_date</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="JNK-data">JNK data<a class="anchor-link" href="#JNK-data"> </a></h2><p>The data from the JNK longwall comes in two formats:</p>
<ol>
<li>Queryable database</li>
<li>Preprocessed pickle files</li>
<li>Preprocessed CSV files</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="JNK-pickle-files">JNK pickle files<a class="anchor-link" href="#JNK-pickle-files"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">base_path_JNK</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/data/PACMEL-2019/JNK/&#39;</span><span class="p">)</span> <span class="c1"># *</span>
<span class="p">[</span><span class="n">path</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">base_path_JNK</span><span class="o">.</span><span class="n">ls</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's read the pickle files and show the contents of each of them</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first file is a dataframe with information about the <em>boolean variables</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">df_bool_dict</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_bool_dict</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The second file is a dataframe with information about the <em>categorical variables</em></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">df_categorical_dict</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_categorical_dict</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The third file is a dataframe with the raw data of one month of the longwall (June 2019). It contains missing values.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">df_jnk_base</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df_jnk_base</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This dataframe contains all the 95 bool variables described in the first pickle file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df_jnk_base</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_jnk_base</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_bool_dict</span><span class="o">.</span><span class="n">bool_variables</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, not all the variables listed in the dataframe for the categorical variables are present in the base data. (TODO: as why!). We can check which categorical variables are in the base data.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_jnk_base</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">df_categorical_dict</span><span class="o">.</span><span class="n">categorical_variables</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 4th file is called <code>jnk_before_handling_missing</code>, and it is a list f 4 elements:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">jnk_before_handling_missing</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first element is a dataframe with a subset of 16 columns from the base data (the number of rows is the same).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The second and third elements of the list mark which of the variables of this dataframe are boolean, numerical, and categorical respectively.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">set</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df_bool_dict</span><span class="o">.</span><span class="n">bool_variables</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">set</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df_bool_dict</span><span class="o">.</span><span class="n">bool_variables</span><span class="p">),</span> \
<span class="nb">set</span><span class="p">(</span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">df_categorical_dict</span><span class="o">.</span><span class="n">categorical_variables</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jnk_before_handling_missing</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This subset of data may represent the most interesting variables of analysis from an expert perspective (TODO: confirm).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 5th and 6th pickle files look like an output instead of an input. More specifically, both of them are lists with two items:</p>
<ol>
<li>A 11 $\times$ 11 array, containing the description of 11 clusters.</li>
<li>An array of 1363601 elements with 11 different values (from 0 to 10), containing the assignation of each data point to each of the 11 clusters described in the first element of the file.</li>
</ol>
<p>The input dataset to achieve this result must be a preprocessed input, due to the size of the assignment array is much lower than the size of the base dataframe. Also,the number of columns of this input dataset should be 11, in case the first element of the list represents a multidimensional description of a cluster.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The 7th file, <code>jnk_filled_removelong_imputeinterpolate_nothing.pickle</code>, is a list with two elements.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">jnk_filled_removelong_imputeinterpolate_nothing</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">jnk_filled_removelong_imputeinterpolate_nothing</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first item in the list contains a dataframe with the same number of rows that the clustering results mentioned above. Therefore, this is the preppreprocessed data used for those clustering computations.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jnk_filled_removelong_imputeinterpolate_nothing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">(),</span> 
     <span class="n">jnk_files</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">jnk_filled_removelong_imputeinterpolate_nothing</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The columns of this datafrae are classified in the second element of the list. It¡s the same set of variables than the dataset seen in the file <code>jnk_before_handling_missing</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can check te effect of the removed periods if we compare the evolution of the timestamps between this dataset and the one without preprocessing.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">jnk_files</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This must be taken into account when making use of this datasets. If one wants to consider timestamps as a countinuos source of information, even if there is no data, this last dataset, and none of them with removed periods, is an option for that analysis. For example, a forecastig task should take this very carefully.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Files 8th to 13th are the results of processing the data with the library <code>ts_learn</code>, and the resulting cluasters found in the data when using that preprocessing. Each file corresponds to the use of a different feature extracted from the package (mean, first element...) but I do not know more details about it. For know, these files can be ignored.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, the last file is a list the type of variables of all the 146 variables found in the base dataframe.</p>
<ol>
<li>The first element lists the boolean variables</li>
<li>The second element lists the numeric variables</li>
<li>The third element lists the categorical variables</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">filepaths_pickle</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">types_variables</span> <span class="o">=</span> <span class="n">jnk_files</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
<span class="n">types_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">types_variables</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">types_variables</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Export-notebook">Export notebook<a class="anchor-link" href="#Export-notebook"> </a></h2>
</div>
</div>
</div>
</div>
 

