---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/01_dataset_artifact.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_dataset_artifact.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-artifact-from-time-series-dataframe">Create artifact from time series dataframe<a class="anchor-link" href="#Create-artifact-from-time-series-dataframe"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fastcore.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">wandb</span>
<span class="kn">from</span> <span class="nn">timecluster_extension.load</span> <span class="kn">import</span> <span class="n">TSArtifact</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Notebook-config">Notebook config<a class="anchor-link" href="#Notebook-config"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span>
    <span class="n">use_wandb</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Whether to use or not wandb for experiment tracking</span>
    <span class="n">wandb_entity</span> <span class="o">=</span> <span class="s1">&#39;pacmel&#39;</span><span class="p">,</span>
    <span class="n">wandb_project</span> <span class="o">=</span> <span class="s1">&#39;timecluster_extension&#39;</span><span class="p">,</span>
    <span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="s1">&#39;data/PACMEL-2019/JNK/&#39;</span><span class="p">,</span> <span class="c1"># Folder path where you data lives</span>
    <span class="n">data_file_name</span> <span class="o">=</span> <span class="s1">&#39;jnk_before_handling_missing.pickle&#39;</span><span class="p">,</span> <span class="c1"># Name of the data file. Must be a pickle file</span>
    <span class="n">variables_file_name</span> <span class="o">=</span> <span class="s1">&#39;mining-mapping.csv&#39;</span><span class="p">,</span>
    <span class="n">wandb_artifacts_path</span> <span class="o">=</span> <span class="s1">&#39;data/PACMEL-2019/wandb_artifacts&#39;</span><span class="p">,</span> <span class="c1"># Output path where the resulting TSArtifact will be stored</span>
    <span class="n">artifact_name</span> <span class="o">=</span> <span class="s1">&#39;JNK&#39;</span><span class="p">,</span> <span class="c1"># Name of the artifact to be created</span>
    <span class="n">joining_validation_test</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">#True to create an artifact linking validation and testing data or False if it doesn&#39;t</span>
    <span class="c1"># training, validation and testing days</span>
    <span class="n">range_training</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="c1">#[15 days]</span>
    <span class="n">range_validation</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="c1">#[5 days]</span>
    <span class="n">range_testing</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>  <span class="c1">#[9 days]</span>
    <span class="n">resampling_freq</span> <span class="o">=</span> <span class="s1">&#39;5s&#39;</span><span class="p">,</span> <span class="c1"># resampling frequency</span>
    <span class="n">missing_values_technique</span><span class="o">=</span><span class="s1">&#39;linear_interpolation&#39;</span> <span class="c1"># handle missing values technique</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Run">Run<a class="anchor-link" href="#Run"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the experiment tracking and hyperparameter we will use the tool <strong>Weights &amp; Biases</strong>.</p>
<p>Before running this notebook part, make sure you have the <code>$WANDB_API_KEY</code> environment varibale defined with your API_KEY (run in a terminal <code>echo $WANDB_API_KEY</code> to see it). If not, run in a terminal <code>wandb login [API_KEY]</code>. You can see your API_KEY <a href="https://wandb.ai/authorize">here</a> or in the settings of your W&amp;B account.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">entity</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">wandb_entity</span><span class="p">,</span> 
                 <span class="n">project</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">wandb_project</span><span class="p">,</span> 
                 <span class="n">job_type</span><span class="o">=</span><span class="s1">&#39;create_dataset&#39;</span><span class="p">,</span> 
                 <span class="n">resume</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;online&#39;</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">use_wandb</span> <span class="k">else</span> <span class="s1">&#39;offline&#39;</span><span class="p">,</span>
                 <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">wandb</span><span class="o">.</span><span class="n">config</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-blue-intense-fg ansi-bold">wandb</span>: W&amp;B syncing is set to `offline` in this directory.  Run `wandb online` or set WANDB_MODE=online to enable cloud syncing.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-Extraction">Data Extraction<a class="anchor-link" href="#Data-Extraction"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The data is assumed to come as a dataframe binarized in a picke file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">data_file_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">bin_data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bin_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File loaded successfully&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>File loaded successfully
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">main_df</span> <span class="o">=</span> <span class="n">data_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">main_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Num. variables: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">main_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Num. variables: 16
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">main_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>  <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-Transformation">Data Transformation<a class="anchor-link" href="#Data-Transformation"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="1.-Previous-transformations">1. Previous transformations<a class="anchor-link" href="#1.-Previous-transformations"> </a></h5><p>In this part, filters or transformation can be defined depending on variables origin or time-dependent features, among others.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">base_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">variables_file_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Variable name&#39;</span><span class="p">)</span>
<span class="n">data_var_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span> <span class="p">:</span> <span class="n">var_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">var</span><span class="p">,</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">main_df</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
<span class="n">data_var_type</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;RCD_AverageThree-phaseCurrent&#39;: &#39;double&#39;,
 &#39;LCD_AverageThree-phaseCurrent&#39;: &#39;double&#39;,
 &#39;LP_AverageThree-phaseCurrent&#39;: &#39;double&#39;,
 &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;: &#39;double&#39;,
 &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;: &#39;double&#39;,
 &#39;LA_LeftArmTemperature&#39;: &#39;double&#39;,
 &#39;RA_RightArmTemperature&#39;: &#39;double&#39;,
 &#39;SM_DailyRouteOfTheShearer&#39;: &#39;double&#39;,
 &#39;SM_TotalRoute&#39;: &#39;double&#39;,
 &#39;LHD_EngineCurrent&#39;: &#39;double&#39;,
 &#39;RHD_EngineCurrent&#39;: &#39;double&#39;,
 &#39;RCD_BearingTemperature&#39;: &#39;double&#39;,
 &#39;SM_ShearerSpeed&#39;: &#39;double&#39;,
 &#39;SM_ShearerLocation&#39;: &#39;double&#39;,
 &#39;SM_ShearerMoveInLeft&#39;: &#39;bool&#39;,
 &#39;SM_ShearerMoveInRight&#39;: &#39;bool&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">double_var_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">var_type</span> <span class="ow">in</span> <span class="n">data_var_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;double&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">main_df</span><span class="p">[</span><span class="n">main_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">double_var_list</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Num. variables: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Num. variables: 14
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2.-Handle-Missing-Values,-Resample-and-Normalize">2. Handle Missing Values, Resample and Normalize<a class="anchor-link" href="#2.-Handle-Missing-Values,-Resample-and-Normalize"> </a></h5><p>In this second part, Time Series Artifact (TSArtifact) object can be created and missing values handling techniques, resampling and normalization can be applied. This techniques should be applied on the three subsets that must be previously created: training, validation and testing.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">range_training</span>
<span class="n">df_training</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index.dt.day.isin(@rg)&#39;</span><span class="p">)</span>
<span class="n">training_artifact</span> <span class="o">=</span> <span class="n">TSArtifact</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df_training</span><span class="p">,</span> 
                                       <span class="n">name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">artifact_name</span><span class="p">,</span> 
                                       <span class="n">missing_values_technique</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">missing_values_technique</span><span class="p">,</span>
                                       <span class="n">resampling_freq</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">resampling_freq</span><span class="p">,</span> 
                                       <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                       <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">wandb_artifacts_path</span><span class="p">))</span>
<span class="n">training_artifact</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;TS&#39;: {&#39;sd&#39;: &#39;2019-06-01 00:00:00&#39;,
  &#39;ed&#39;: &#39;2019-06-15 23:59:59&#39;,
  &#39;created&#39;: &#39;from-df&#39;,
  &#39;n_vars&#39;: 14,
  &#39;handle_missing_values_technique&#39;: &#39;linear_interpolation&#39;,
  &#39;has_missing_values&#39;: &#39;False&#39;,
  &#39;n_samples&#39;: 259200,
  &#39;freq&#39;: &#39;&lt;5 * Seconds&gt;&#39;,
  &#39;vars&#39;: [&#39;RCD_AverageThree-phaseCurrent&#39;,
   &#39;LCD_AverageThree-phaseCurrent&#39;,
   &#39;LP_AverageThree-phaseCurrent&#39;,
   &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;LA_LeftArmTemperature&#39;,
   &#39;RA_RightArmTemperature&#39;,
   &#39;SM_DailyRouteOfTheShearer&#39;,
   &#39;SM_TotalRoute&#39;,
   &#39;LHD_EngineCurrent&#39;,
   &#39;RHD_EngineCurrent&#39;,
   &#39;RCD_BearingTemperature&#39;,
   &#39;SM_ShearerSpeed&#39;,
   &#39;SM_ShearerLocation&#39;],
  &#39;normalization&#39;: {&#39;means&#39;: {&#39;RCD_AverageThree-phaseCurrent&#39;: 39.716197145061734,
    &#39;LCD_AverageThree-phaseCurrent&#39;: 38.54135300925926,
    &#39;LP_AverageThree-phaseCurrent&#39;: 2.0873996913580246,
    &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;: 58.599024305555545,
    &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;: 5.362503858024692,
    &#39;LA_LeftArmTemperature&#39;: 40.62779475308641,
    &#39;RA_RightArmTemperature&#39;: 45.485603780864196,
    &#39;SM_DailyRouteOfTheShearer&#39;: 1237.903117669753,
    &#39;SM_TotalRoute&#39;: 136.34325933641975,
    &#39;LHD_EngineCurrent&#39;: 14.246463734567898,
    &#39;RHD_EngineCurrent&#39;: 13.827609182098767,
    &#39;RCD_BearingTemperature&#39;: 56.507376929012345,
    &#39;SM_ShearerSpeed&#39;: 1.3397615740740743,
    &#39;SM_ShearerLocation&#39;: 110.98749266975311},
   &#39;stds&#39;: {&#39;RCD_AverageThree-phaseCurrent&#39;: 39.70874699748392,
    &#39;LCD_AverageThree-phaseCurrent&#39;: 38.61929903430235,
    &#39;LP_AverageThree-phaseCurrent&#39;: 2.673350849994161,
    &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;: 25.035533125060464,
    &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;: 16.451733417066187,
    &#39;LA_LeftArmTemperature&#39;: 12.062064306810887,
    &#39;RA_RightArmTemperature&#39;: 14.594512578518268,
    &#39;SM_DailyRouteOfTheShearer&#39;: 1106.0032357437624,
    &#39;SM_TotalRoute&#39;: 18.041910697747443,
    &#39;LHD_EngineCurrent&#39;: 22.96903715909201,
    &#39;RHD_EngineCurrent&#39;: 22.322453739143615,
    &#39;RCD_BearingTemperature&#39;: 15.648129884554898,
    &#39;SM_ShearerSpeed&#39;: 3.154401611746743,
    &#39;SM_ShearerLocation&#39;: 84.53613420968614}},
  &#39;hash&#39;: &#39;8576676432943501972&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">range_validation</span>
<span class="n">df_validation</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index.dt.day.isin(@rg)&#39;</span><span class="p">)</span>
<span class="n">validation_artifact</span> <span class="o">=</span> <span class="n">TSArtifact</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df_validation</span><span class="p">,</span>
                                         <span class="n">name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">artifact_name</span><span class="p">,</span> 
                                         <span class="n">missing_values_technique</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">missing_values_technique</span><span class="p">,</span>
                                         <span class="n">resampling_freq</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">resampling_freq</span><span class="p">,</span> 
                                         <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                         <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">wandb_artifacts_path</span><span class="p">))</span>
<span class="n">validation_artifact</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;TS&#39;: {&#39;sd&#39;: &#39;2019-06-16 00:00:00&#39;,
  &#39;ed&#39;: &#39;2019-06-20 23:59:59&#39;,
  &#39;created&#39;: &#39;from-df&#39;,
  &#39;n_vars&#39;: 14,
  &#39;handle_missing_values_technique&#39;: &#39;linear_interpolation&#39;,
  &#39;has_missing_values&#39;: &#39;False&#39;,
  &#39;n_samples&#39;: 86400,
  &#39;freq&#39;: &#39;&lt;5 * Seconds&gt;&#39;,
  &#39;vars&#39;: [&#39;RCD_AverageThree-phaseCurrent&#39;,
   &#39;LCD_AverageThree-phaseCurrent&#39;,
   &#39;LP_AverageThree-phaseCurrent&#39;,
   &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;LA_LeftArmTemperature&#39;,
   &#39;RA_RightArmTemperature&#39;,
   &#39;SM_DailyRouteOfTheShearer&#39;,
   &#39;SM_TotalRoute&#39;,
   &#39;LHD_EngineCurrent&#39;,
   &#39;RHD_EngineCurrent&#39;,
   &#39;RCD_BearingTemperature&#39;,
   &#39;SM_ShearerSpeed&#39;,
   &#39;SM_ShearerLocation&#39;],
  &#39;hash&#39;: &#39;-5501534258397058373&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">range_testing</span>
<span class="n">df_testing</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index.dt.day.isin(@rg)&#39;</span><span class="p">)</span>
<span class="n">testing_artifact</span> <span class="o">=</span> <span class="n">TSArtifact</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df_testing</span><span class="p">,</span>
                                      <span class="n">name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">artifact_name</span><span class="p">,</span> 
                                      <span class="n">missing_values_technique</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">missing_values_technique</span><span class="p">,</span>
                                      <span class="n">resampling_freq</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">resampling_freq</span><span class="p">,</span> 
                                      <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">wandb_artifacts_path</span><span class="p">))</span>
<span class="n">testing_artifact</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;TS&#39;: {&#39;sd&#39;: &#39;2019-06-21 00:00:00&#39;,
  &#39;ed&#39;: &#39;2019-06-29 23:59:59&#39;,
  &#39;created&#39;: &#39;from-df&#39;,
  &#39;n_vars&#39;: 14,
  &#39;handle_missing_values_technique&#39;: &#39;linear_interpolation&#39;,
  &#39;has_missing_values&#39;: &#39;False&#39;,
  &#39;n_samples&#39;: 155520,
  &#39;freq&#39;: &#39;&lt;5 * Seconds&gt;&#39;,
  &#39;vars&#39;: [&#39;RCD_AverageThree-phaseCurrent&#39;,
   &#39;LCD_AverageThree-phaseCurrent&#39;,
   &#39;LP_AverageThree-phaseCurrent&#39;,
   &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;,
   &#39;LA_LeftArmTemperature&#39;,
   &#39;RA_RightArmTemperature&#39;,
   &#39;SM_DailyRouteOfTheShearer&#39;,
   &#39;SM_TotalRoute&#39;,
   &#39;LHD_EngineCurrent&#39;,
   &#39;RHD_EngineCurrent&#39;,
   &#39;RCD_BearingTemperature&#39;,
   &#39;SM_ShearerSpeed&#39;,
   &#39;SM_ShearerLocation&#39;],
  &#39;hash&#39;: &#39;-6632507113984032164&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">joining_validation_test</span><span class="p">):</span>
    <span class="n">val_test_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">range_validation</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">range_testing</span><span class="p">)</span>
    <span class="n">df_val_test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;index.dt.day.isin(@val_test_range)&#39;</span><span class="p">)</span>
    <span class="n">val_test_artifact</span> <span class="o">=</span> <span class="n">TSArtifact</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">df_val_test</span><span class="p">,</span>
                                           <span class="n">name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">artifact_name</span><span class="p">,</span> 
                                           <span class="n">missing_values_technique</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">missing_values_technique</span><span class="p">,</span>
                                           <span class="n">resampling_freq</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">resampling_freq</span><span class="p">,</span> 
                                           <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">wandb_artifacts_path</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">val_test_artifact</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;TS&#39;: {&#39;sd&#39;: &#39;2019-06-16 00:00:00&#39;, &#39;ed&#39;: &#39;2019-06-29 23:59:59&#39;, &#39;created&#39;: &#39;from-df&#39;, &#39;n_vars&#39;: 14, &#39;handle_missing_values_technique&#39;: &#39;linear_interpolation&#39;, &#39;has_missing_values&#39;: &#39;False&#39;, &#39;n_samples&#39;: 241920, &#39;freq&#39;: &#39;&lt;5 * Seconds&gt;&#39;, &#39;vars&#39;: [&#39;RCD_AverageThree-phaseCurrent&#39;, &#39;LCD_AverageThree-phaseCurrent&#39;, &#39;LP_AverageThree-phaseCurrent&#39;, &#39;LHD_LeftHaulageDrive(tractor)Temperature(gearbox)&#39;, &#39;RHD_RightHaulageDrive(tractor)Temperature(gearbox)&#39;, &#39;LA_LeftArmTemperature&#39;, &#39;RA_RightArmTemperature&#39;, &#39;SM_DailyRouteOfTheShearer&#39;, &#39;SM_TotalRoute&#39;, &#39;LHD_EngineCurrent&#39;, &#39;RHD_EngineCurrent&#39;, &#39;RCD_BearingTemperature&#39;, &#39;SM_ShearerSpeed&#39;, &#39;SM_ShearerLocation&#39;], &#39;hash&#39;: &#39;-3445972596578682469&#39;}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-Loading">Data Loading<a class="anchor-link" href="#Data-Loading"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">training_artifact</span><span class="p">)</span>
<span class="n">run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">validation_artifact</span><span class="p">)</span>
<span class="n">run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">testing_artifact</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">joining_validation_test</span><span class="p">):</span>
    <span class="n">run</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">val_test_artifact</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">run</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<br/>Waiting for W&B process to finish, PID 705<br/>Program ended successfully.
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
Find user logs for this run at: <code>/home/victor/work/nbs/wandb/offline-run-20210527_172157-32t2j9by/logs/debug.log</code>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
Find internal logs for this run at: <code>/home/victor/work/nbs/wandb/offline-run-20210527_172157-32t2j9by/logs/debug-internal.log</code>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="ansi-blue-intense-fg ansi-bold">wandb</span>: You can sync this run to the cloud by running:
<span class="ansi-blue-intense-fg ansi-bold">wandb</span>: <span class="ansi-yellow-fg">wandb sync /home/victor/work/nbs/wandb/offline-run-20210527_172157-32t2j9by</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

